@using EmployeeInformations.Business.IService;
@using EmployeeInformations.Model.EmployeeSettingViewModel;
@using EmployeeInformations.Common.Enums;
@using Microsoft.AspNetCore.Http;
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor;
@inject IEmployeeInformationService employeeInformationService;
@model EmployeeSetting;
@{
    ViewBag.Title = "CreateSetting";
    Layout = "_Layout";

    var loginRoleId = Context.Session.GetInt32("RoleId");
    var loginEmpId = Context.Session.GetInt32("EmpId");

    var rolePrivileges = false;
    if (loginRoleId >= 0)
    {
        var id = loginRoleId.Value;
        int leaveSummaryModuleId = (int)EmployeesInformationsPages.EmployeeSetting;
        rolePrivileges = await employeeInformationService.ReadAndWritePermissionByRoleId(leaveSummaryModuleId, id);
    }
}
<div class="nk-block-head nk-block-head-sm">
    <div class="nk-block-between">
        <div class="nk-block-head-content">
            <h3 class="nk-block-title page-title">Employee Setting</h3>
        </div><!-- .nk-block-head-content -->
    </div><!-- .nk-block-between -->
</div>
<div class="tab-content">
    <div class="tab-pane active">
        <br>
        @Html.HiddenFor(m => m.EmployeeSettingId)
        <div class="row">
            @if (Model != null)
            { 
                @if (Model.ProbationMonths == 0)
                {
                    <div class="col-lg-3">
                        <div class="form-group">
                            <label>Probation Months<span class="required" style="color: #FF0000">*</span></label>
                            <input type="number" class="form-control" id="Probationmonth" />
                            <span id="errValid-Probationmonths" class="text-danger" />
                        </div>
                    </div>

                }
                else
                {
                    <div class="col-lg-3">
                        <div class="form-group">
                            <label>Probation Months<span class="required" style="color: #FF0000">*</span></label>
                            @Html.TextBoxFor(m => m.ProbationMonths, new { @class = "form-control",id="Probationmonth",type="number"})
                            @Html.ValidationMessageFor(x=>x.ProbationMonths ,"" , new { @class ="error text-danger", @id="errValid-Probationmonths"})
                        </div>
                    </div>
                }
             }
            else
            {
                <div class="col-lg-3">
                    <div class="form-group">
                        <label>Probation Months<span class="required" style="color: #FF0000">*</span></label>
                        <input type="number" class="form-control" id="Probationmonth" />
                        <span id="errValid-Probationmonths" class="text-danger" />
                    </div>
                </div>
            } 
        </div>
    </div>
</div>

<div class="col-lg-12 d-flex mt-3 p-0">
    @if (Model != null)
    {
        @if (Model.EmployeeSettingId == 0)
        {
            <input type="button" class="btn btn-primary ml-auto" id="btnProbationMonths" value="Add" />
        }
        else
        {
            <input type="button" class="btn btn-primary ml-auto" id="btnProbationMonths" value="Update" />
        }
    }
    else
    {
        <input type="button" class="btn btn-primary ml-auto" id="btnProbationMonths" value="Add" />
    }

</div>

<Script>

    $("#Probationmonth").keyup(function () {
        $("#errValid-Probationmonths").text("");
        if ($("#Probationmonth").val() == "") {
            $("#errValid-Probationmonths").text("Probation Months field is required");
        }
    });

    $("#btnProbationMonths").click( function(){
        $("#errValid-Probationmonths").text("");
        var isValid= true;
        
        var month = $("#Probationmonth").val();
        if ($("#Probationmonth").val() == "") {
            $("#errValid-Probationmonths").text("Probation Months field is required");
            isValid = false;
        }

        var id = $("#EmployeeSettingId").val();
        var formData = new FormData();
        formData.append("ProbationMonths",month);
        formData.append("EmployeeSettingId", id);
        if (isValid)
        {
            $.ajax({
                type: "POST",
                url: "/EmployeeSetting/AddSetting",
                data: formData,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $('.loader').removeClass('d-none');
                },
                success: function (result) {
                    if (result == true) {
                            Swal.fire({
        title: 'Updated Successfully',
        text: "",
        icon: 'success',
        allowOutsideClick: false
    }).then((resultValue) => {
        if (resultValue.isConfirmed) {
                                window.location.href = "/EmployeeSetting/CreateSetting";
                            };
    });                      
                    }
                    else {
                            Swal.fire({
        title: 'Something error',
        text: "",
        icon: 'error',
        allowOutsideClick: false
    }).then((resultValue) => {
       window.location.href = "/EmployeeSetting/CreateSetting";
    });                       
                    }                    
                },
                complete: function () {
                    $('.loader').addClass('d-none');
                }

            });

        }       
    });


</Script>
