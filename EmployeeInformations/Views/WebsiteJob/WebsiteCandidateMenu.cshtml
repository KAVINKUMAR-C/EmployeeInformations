@using EmployeeInformations.Common
@using EmployeeInformations.Common.Enums
@using EmployeeInformations.Model.APIModel;
@model WebsiteCandidateMenuModel
@{
    ViewBag.Title = "WebsiteCandidateMenu";
    Layout = "_Layout";

}

<div class="nk-block-head nk-block-head-sm">
    <div class="nk-block-between">
        <div class="nk-block-head-content">
            <h3 class="nk-block-title page-title">Website Candidate Menu</h3>
        </div><!-- .nk-block-head-content -->
    </div><!-- .nk-block-between -->
</div><!-- .nk-block-head -->



<div class="card card-bordered card-preview">
    <div class="card-inner table-card">
        <table class="display employee-holiday-table mb-3 no-sorting" style="width:100%" data-auto-responsive="false" id="getJobApplyData">
            <thead>
                <tr class="nk-tb-item table-header">
                    <th class="nk-tb-col tb-col col-w" data-id="FullName"><span class="sub-text">Name</span></th>
                    <th class="nk-tb-col" data-id="JobName"><span class="sub-text">Role</span></th>
                    <th class="nk-tb-col tb-col" data-id="Experience"><span class="sub-text">Experience</span></th>
                    <th class="nk-tb-col tb-col" data-id="RelevantExperience"><span class="sub-text">Relevant Experience</span></th>
                    <th class="nk-tb-col tb-col" data-id="ApplyDate"><span class="sub-text">Applied Date</span></th>
                    <th class="nk-tb-col tb-col" data-id="CandidateStatusName"><span class="sub-text">Status</span></th>
                    <th class="nk-tb-col tb-col" data-id="ScheduleName"><span class="sub-text">Candidate Schedule Name</span></th>
                    <th class="nk-tb-col tb-col" data-id="EmployeeName"><span class="sub-text">Interviewer</span></th>
                    <th class="nk-tb-col tb-col" data-id="MeetingLink"><span class="sub-text">Meeting Link</span></th>
                    <th class="nk-tb-col tb-col"><span class="sub-text">Action</span></th>
                </tr>
            </thead>            
        </table>
    </div>
</div>

<div class="modal" id="EditJobApply" style="display:none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Candidate schedule</h5>
            </div>
            <!-- Modal body -->
            <div class="modal-body" id="txtSuccessMeg">
                <div class="col-lg-12 autocomplete">
                    <div class="form-group emp-hol-yr">

                        <label class="form-label">Candidate Schedule<span class="required" style="color: #FF0000">*</span></label>
                        <div>
                            @Html.DropDownListFor(m => m.CandidateScheduleId, new SelectList(Model.WebsiteCandidateSchedules, "CandidateScheduleId", "ScheduleName"), "Please select", new { @class = "form-control select2", id = "candidateSchedule" })
                        </div>
                        @Html.ValidationMessageFor(m => m.CandidateScheduleId, "", new { @class = "error text-danger", id = "errValid-schedule" })

                    </div>
                </div>


                <div class="col-lg-12 autocomplete">
                    <div class="form-group emp-hol-yr">

                        <label class="form-label">Interviewer<span class="required" style="color: #FF0000">*</span></label>
                        <div class="selectbox">
                            @Html.DropDownListFor(m => m.EmployeeId, new SelectList(Model.DropdownEmployee, "EmpId", "FirstName"), new { @class = "form-control select2", id = "EmployeeId", multiple = true })
                        </div>
                        @Html.ValidationMessageFor(m => m.EmployeeId, "", new { @class = "error text-danger", id = "errValid-EmployeeId" })

                    </div>
                </div>


                <div class="col-lg-12 ">
                    <div class="form-group">
                        <label class="form-label">Scheduled Date<span class="required" style="color: #FF0000">*</span></label>
                        <div id="datepickerScheduledDate" class="input-group date" data-date-format="yyyy/mm/dd">
                            @if (Model.ScheduledDate == DateTime.MinValue)
                            {
                                <input type="text" class="form-control" id="ScheduledDate" value="" placeholder="" />
                            }
                            else
                            {
                                @Html.TextBoxFor(m => m.ScheduledDate, "{0:dd/mm/yyyy}", new { @class = "form-control date-picker", @value = Model.ScheduledDate?.ToString("dd/mm/yyyy") })
                            }
                            <span class="input-group-addon">
                                <i class="icon ti-calendar"></i>
                            </span>
                        </div>
                        @Html.ValidationMessageFor(m => m.ScheduledDate, "", new { @class = "error text-danger", id = "errValid-ScheduledDate" })
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Start Time<span class="required" style="color: #FF0000">*</span></label>
                                <div class="input-group" id="drp_FromTime">
                                    <input type="text" class="form-control" id="StartTime" placeholder="" value="@Model.StartTime">
                                </div>
                                <span class="error text-danger" id="errValid-StartTime"></span>
                            </div>
                        </div>

                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">End Time<span class="required" style="color: #FF0000">*</span></label>
                                <div class="input-group" id="drp_ToTime">
                                    <input type="text" class="form-control" id="EndTime" placeholder="" value="@Model.EndTime">
                                </div>
                                <span class="error text-danger" id="errValid-EndTime"></span>
                                <span id="errVerify-ScheduledEndTime" class="error text-danger" style="display:none;"> Please select <b>End Time</b> should not be less than <b>Start Time</b> </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <input type="text" id="menuedit" hidden />
                </div>
                <div>
                    <input type="text" id="meeting" hidden />
                </div>
                <div class="col-lg-12 d-flex mt-3 p-0">
                    <input type="button" class="btn btn-primary ml-auto mr-3" id="btnCreateSchedule" value="Save" />
                    <input type="button" class="btn btn-danger" id="btnSchedule" value="Cancel" />
                </div>
            </div>
        </div>
    </div>
</div>


@* status popup *@

<div class="modal" id="success_CandidateStatus_Popup" style="display:none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Status</h5>
            </div>
            <!-- Modal body -->
            <div class="modal-body" id="txtSuccessMeg">

                <div class="mb-12">
                    <label class="form-label">Candidate Status<span class="required" style="color: #FF0000">*</span></label>
                    <div>
                        @Html.DropDownListFor(m => m.CandidateStatusId, Html.GetEnumSelectList<CandidateStatus>(), "--Select Status--", new { @class = "form-control", id = "CandidateStsId" })
                    </div>
                    @Html.ValidationMessageFor(m => m.CandidateStatusId, "", new { @class = "error text-danger", id = "errValid-CandidateStsId" })
                </div>

                <div class="col-lg-12 d-flex mt-3 p-0">
                    <input type="button" class="btn btn-primary ml-auto mr-3" id="btnUpdateStatus" value="Save" />
                    <input type="button" class="btn btn-danger" id="btnClose" value="Cancel" />
                </div>

            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function () {

        var columnIndex = "";
        var columnDirection = "";
        var entries = 10;
        BindWebsiteCandidateMenu();
        function BindWebsiteCandidateMenu() {
            var table = $("#getJobApplyData").DataTable();

            if (table) {
                table.destroy();
            }
            var leaveCount = 0;
            $('#getJobApplyData').DataTable({

                //serverSide: true,
                "language": {
                    "infoFiltered": "",
                },
                processing: true,
                pageLength: entries,
                ajax: {
                    url: "/WebsiteJob/GetWebsiteCandidateMenu",
                    type: 'Get',
                    data: function (d) {
                        var searchFilter = document.getElementById("getJobApplyData_filter"); // get search div id
                        var searchInput = searchFilter.querySelector("input[type='search']"); // get search div input
                        var searchValue = searchInput.value;  // get search value
                        var leaveEntry = document.getElementById("getJobApplyData_length"); //get entries div id
                        var entrySelect = leaveEntry.querySelector("select"); //get entries div select
                        entries = entrySelect.value; // get entries value
                        d.sSearch = searchValue; // Pass search query
                        // Pass pagination parameters
                        d.iDisplayStart = d.iDisplayStart || 0;
                        d.iDisplayLength = d.iDisplayLength || entries;
                        d.sEcho = d.start;
                        d.ColumnName = columnIndex;
                        d.ColumnDirection = columnDirection;
                    }
                },

                columns: [
                    {

                        data: 'name',
                        render: function (data, type, row, meta) {
                            if (leaveCount > 5)
                                leaveCount = 1;
                            var className = getClassNameForGrid(leaveCount);
                            leaveCount++;

                            if (row.fullName != null || "") {
                                return "<div class='user-card'>" +

                                    "<div class='user-avatar " + className + "'><span style='text-transform:uppercase' hidden id='menuId'>" + row.candidateMenuId + "</span>" +
                                    "<span style='text-transform:uppercase'>" + (row.fullName)[0] + "</span></div>" +
                                    "<div class='user-info'><div class='user-info'><span class='tb-lead font-weight-bold'>" + row.fullName + "</span>" +" "+
                                    "<span>" + row.email + "</span></div></div></div>"
                            }

                            return "<div class='user-card'>" +

                                "<div class='user-avatar " + className + "'><span style='text-transform:uppercase' hidden id='menuId'>" + row.candidateMenuId + "</span>" +
                                "<span style='text-transform:uppercase'>" + (row.fullName)[0] + "</span></div>" +
                                "<div class='user-info'><div class='user-info'><span class='tb-lead font-weight-bold'>" + row.fullName + "</span>" +
                                "<span>row.email</span></div></div></div>"
                        }
                    },

                    {
                        data: 'role',
                        render: function (data, type, row) {
                            return "<span class='badge badge-dim bg-primary'>" + row.jobName + "</span>"
                        }
                    },

                    {
                        data: 'experience',
                        render: function (data, type, row) {
                            return "<span>" + row.experience + "</span>"
                        }
                    },

                    {
                        data: 'relevantExperience',
                        render: function (data, type, row) {
                            return "<span class='tb-lead font-weight-bold'>" + row.relevantExperience + "</span><span> " + row.skillSet + "</span>"
                        }
                    },

                    {
                        data: 'appliedDate',
                        render: function (data, type, row) {
                            return "<span>" + dateFormat(row.applyDate) + "</span>"
                        }
                    },

                    {
                        data: 'status',
                        render: function (data, type, row) {
                            return "<span>" + row.candidateStatusName + "</span>"
                        }

                    },

                    {
                        data: 'candidateScheduleName',
                        render: function (data, type, row) {
                            return "<span> " + (row.scheduleName == null ? "" : row.scheduleName) + " </span>"
                        }
                    },

                    {
                        data: 'interviewer',
                        render: function (data, type, row) {
                            return "<span class='badge badge-dim bg-primary'>" + (row.employeeName == null ? "" : row.employeeName) + "</span>"
                        }
                    },

                    {
                        data: 'meetingLink',
                        render: function (data, type, row) {
                            if (row.meetingLink == null) { row.meetingLink = "" } else { var trimNewValue = row.meetingLink.replace(/'/g, "").trim(); }
                            return "<div class='leave-reason'><p type='button' class='tb-sub font-weight-bold' data-bs-toggle='tooltip' data-bs-placement='bottom' title='" + trimNewValue + "' id='meetinglink'>" + row.meetingLink + "</p></div>"
                        }
                    },

                    {
                        data: 'null',
                        "orderable": false,
                        render: function (data, type, row) {  
                            
                            var html = "<div class='nk-tb-col nk-tb-col-tools py-0 border-0'><ul class='nk-tb-actions gx-1 my-n1'><li class='me-n1'><div class='dropdown'><a href='#' class='dropdown-toggle btn btn-icon btn-trigger' data-bs-toggle='dropdown'><em class='icon ni ni-more-h'></em></a><div class='dropdown-menu dropdown-menu-end'><ul class='link-list-opt no-bdr'>";

                            if (row.filePath != null) {
                                html += "<li><a href='javascript:void(0)' class='btnDownload' data-file=" + row.filePath + " data-id=" + row.candidateMenuId + "><em class='icon ni ni-download'></em><span>Download</span></a></li>";
                            }

                            if (row.candidateStatusId != 1 && row.candidateStatusId != 2) {
                                var trimemployeeName                                
                                (row.employeeId == null) ? " " : trimemployeeName= row.employeeId.trim();
                                           html += "<li><a href='javascript:void(0)' id='btnUpdate' data-candidatemenuid=" + row.candidateMenuId + " data-id=" + row.candidateScheduleId + " data-date=" + revDateFormat(row.scheduledDate) + " data-starttime=" + timeFormat(row.startTime) + " data-endtime=" + timeFormat(row.endTime) + " data-empnames=" + trimemployeeName + " data-meetlink=" + row.meetingLink + "><em class='icon ni ni-edit'></em><span>Edit</span></a></li>" +
                                    "<li><a href='javascript:void(0)' id='btnStatus' data-id=" + row.candidateMenuId + " data-statusid=" + row.candidateStatusName + "><em class='icon ni ni-edit'></em><span>Status</span></a></li>"
                            }
                            html += "</ul></div></div></li></ul></div>";
                            return html;
                        }
                    },
                ],

                "columnDefs": [
                    { "width": "300px", "targets": [0, 1, 2, 4] },
                    { "width": "200px", "targets": [3, 6, 5, 7, 8] },
                ],

                "createdRow": function (row, data, dataIndex, settings) {
                    // Add custom class to the row
                    $(row).addClass('nk-tb-item');
                    // Add custom classes to each cell in the row if necessary
                    $(row).find('td').addClass('nk-tb-col tb-col');
                },

            });
            // $('[data-bs-toggle="tooltip"]').tooltip();
            $("body").tooltip({ selector: '[data-bs-toggle=tooltip]' });
        }

        $(document).on('click', '.sorting, .sorting_asc, .sorting_desc', function (e) {
            var target = e.target;
            var parent = target.parentNode;
            var index = [].indexOf.call(parent.children, target);

            if ($(this).hasClass('sorting_asc')) {
                columnDirection = 'desc';
            }
            else {
                columnDirection = 'asc'; // Assuming default sorting direction is descending
            }

            columnIndex = $(this).data('id');
        });


        function getClassNameForGrid(input) {
            var className = "";
            switch (input) {
                case 1:
                    className = "bg-success";
                    break;
                case 2:
                    className = "bg-warning";
                    break;
                case 3:
                    className = "bg-info";
                    break;
                case 4:
                    className = "bg-blue";
                    break;
                case 5:
                    className = "bg-pink";
                    break;
                case 6:
                    className = "bg-danger";
                    break;
            }
            return className;
        }

        function dateFormat(startDate) {

            var dateObject = new Date(startDate);
            var day = ("0" + dateObject.getDate()).slice(-2);
            var month = ("0" + (dateObject.getMonth() + 1)).slice(-2);
            var year = dateObject.getFullYear();
            var formattedDate = day + "/" + month + "/" + year;
            return formattedDate;
        }

        function revDateFormat(startDate) {

            var dateObject = new Date(startDate);
            var day = ("0" + dateObject.getDate()).slice(-2);
            var month = ("0" + (dateObject.getMonth() + 1)).slice(-2);
            var year = dateObject.getFullYear();
            var formattedDate = year + "/" + month + "/" + day;
            return formattedDate;
        }

        function timeFormat(createdDate) {
            var dateObject = new Date(createdDate);
            var day = ("0" + dateObject.getDate()).slice(-2);
            var month = ("0" + (dateObject.getMonth() + 1)).slice(-2);
            var year = dateObject.getFullYear();
            var hours = dateObject.getHours();
            var minutes = dateObject.getMinutes();
            var seconds = dateObject.getSeconds();
            var ampm = hours >= 12 ? 'PM' : 'AM';

            // Convert hours from 24-hour to 12-hour format
            if (hours > 12) {
                hours = hours - 12;
            } else if (hours === 0) {
                hours = 12;
            }

            // Add leading zeros to minutes and seconds
            minutes = ("0" + minutes).slice(-2);
            seconds = ("0" + seconds).slice(-2);

            var formattedDate = hours + ":" + minutes + " " + ampm;
            return formattedDate;
        }

    @* $.fn.dataTable.moment('DD/MM/YYYY');

            $('#getJobApplyData').DataTable({
            "bInfo": true,
            "paging": true,
            }); *@

            $("#datepickerScheduledDate").datepicker({
                autoclose: true,
                todayHighlight: true,
            });

        $('#StartTime').timepicker({
            dynamic: false,
            dropdown: true,
            scrollbar: true,
            change: function (time) {
                $("#errValid-StartTime").text("");
                if ($("#StartTime").val() == "") {
                    $("#errValid-StartTime").text("Start Time field is required");
                }
            }
        });

        $('#EndTime').timepicker({
            dynamic: false,
            dropdown: true,
            scrollbar: true,
            change: function (time) {
                $("#errValid-EndTime").text("");
                if ($("#EndTime").val() == "") {
                    $("#errValid-EndTime").text("End Time field is required");
                    $("#errVerify-ScheduledEndTime").hide();
                }
            }
        });

        // nice scroll for CandidateStatus

        $("#CandidateStsId,#candidateSchedule,#EmployeeId").select2().on("select2:open", function () {
            $('.select2-results__options').niceScroll({
                cursorcolor: "#4e5e7a",
                cursorwidth: "5px",
                autohidemode: false,
                cursorborder: "1px solid #4e5e7a",
                horizrailenabled: false,
            });
        });

        //Change Summary

        $("#CandidateStsId").change(function () {
            if ($("#CandidateStsId").val() == '' || $("#CandidateStsId").val() == null) {
                $("#errValid-CandidateStsId").text("Status field is required");
            }
            else {
                $("#errValid-CandidateStsId").text("");
            }
        });
       
    });

    $("#candidateSchedule").change(function () {
        $("#errValid-schedule").text("");
        if ($("#candidateSchedule").val() == "0") {
            $("#errValid-schedule").text("Candidate Schedule field is required");
        }
    });

    $("#EmployeeId").select2();

    var employeeId = $("#EmployeeId").select2();
    $("#EmployeeId").select2().on("change", function () {
        $("#errValid-EmployeeId").text("");
    });

    $("#EmployeeId").change(function () {
        $("#errValid-EmployeeId").text("");
        if ($("#EmployeeId").val() == "" || $("#CandidateStsId").val() == null) {
            $("#errValid-EmployeeId").text("Employee field is required");
        }
    });

    //Change Summary
    $("#ScheduledDate").change(function () {
        $("#errValid-ScheduledDate").text("");
        if ($("#ScheduledDate").val() == "") {
            $("#errValid-ScheduledDate").text("Scheduled Date field is required");
        }
        else {
            $("#errValid-ScheduledDate").text("");
        }
    });

    $('#getJobApplyData').on('click', '#btnUpdate', function () {
        $("#errValid-schedule").text("");
        var candidateId = $(this).data("id");
        var candidatesMenuId = $(this).data("candidatemenuid");
        var startDate = $(this).data("date");
        var startTime = $(this).data("starttime");
        var endTime = $(this).data("endtime");
        var empNames = $(this).data("empnames").toString();
        var emp = (empNames == "undefined") ? null : empNames;
        var meetinglink = $(this).data("meetlink");
        $.ajax({
            type: 'GET',
            url: "/WebsiteJob/WebsiteCandidateScheduleByid?candidateId=" + candidateId,
            contentType: false,
            processData: false,
            success: (Result) => {
                $('#candidateSchedule').html('')

                $('#candidateSchedule').append($('<option> ' + "--Select Candidate--" + ' </option>').val("0").html("--Select Candidate--"));
                var schedule = Result.websiteCandidateSchedules.map(function (value) {
                   @*  $.each(Result.websiteCandidateSchedules, function (key, value) { *@
                        $('#candidateSchedule').append($('<option> ' + value.scheduleName + ' </option>').val(value.candidateScheduleId).html(value.scheduleName));
                });
                $("#candidateSchedule option[value=" + candidateId + "]").attr('selected', 'selected').trigger("change");

            }


        });
        $("#menuedit").val(candidatesMenuId);
        if (emp) {
            var splitReportingPersonId = emp.toString().split(',');

            $('#EmployeeId option:selected').prop('selected', false);

            $.each(splitReportingPersonId, function (index, empId) {
                $("#EmployeeId option[value='" + empId + "']").prop('selected', true);
            });

            $('#EmployeeId').trigger("change");
        }
        $("#ScheduledDate").val(startDate);
        $("#StartTime").val(startTime);
        $("#EndTime").val(endTime);
        $("#meeting").val(meetinglink);
        $("#EditJobApply").modal('show');


        $('#EditJobApply').on('click', '#btnCreateSchedule', function () {

            var isValid = true;
            var formData = new FormData();
            var candidateMenuId = $("#menuedit").val();
            var candidatescheduleId = $("#candidateSchedule").val();
            var scheduleddate = $("#ScheduledDate").val();
            var starttime = $("#StartTime").val();
            var endtime = $("#EndTime").val();
            var employeeId = $("#EmployeeId").val();
            var zoomMeetinglink = $("#meeting").val();
            $("#errValid-ScheduledDate").text("");
            $("#errVerify-ScheduledEndTime").hide();
            $("#errValid-ScheduledDate").text("");
            $("#errValid-StartTime").text("");
            $("#errValid-EmployeeId").text("");

            if ($("#ScheduledDate").val() == "") {
                $("#errValid-ScheduledDate").text("Scheduled Date field is required");
                isValid = false;
            }

            if ($("#StartTime").val() == "") {
                $("#errValid-StartTime").text("Start Time field is required");
                isValid = false;
            }

            if ($("#EndTime").val() == "") {
                $("#errValid-EndTime").text("End Time field is required");
                isValid = false;
            }


            if ($("#EmployeeId").val() == "") {
                $("#errValid-EmployeeId").text("Employee field is required");
                isValid = false;
            }

            formData.append("CandidatescheduleId", candidatescheduleId);
            formData.append("CandidateMenuId", candidatesMenuId);
            formData.append("StrScheduledDate", scheduleddate);
            formData.append("StrStartTime", starttime);
            formData.append("StrEndTime", endtime);
            formData.append("EmployeeId", employeeId);
            formData.append("MeetingLink", zoomMeetinglink);

            var websiteCandidateMenuModel = {
                StrStartTime: starttime,
                StrEndTime: endtime
            };

            if ($("#candidateSchedule").val() == "0" || $("#candidateSchedule").val() == null) {
                $("#errValid-schedule").text("Candidate Schedule field is required");
                isValid = false;
            }
            if (isValid) {
                var isTimeValid = getTimeValid(scheduleddate, starttime, endtime);
                if (isTimeValid) {
                    $('.loader').removeClass('d-none');
                    $.ajax({
                        type: "Post",
                        url: "/WebsiteJob/UpdateWebsiteCandidateMenu",
                        data: formData,
                        contentType: false,
                        processData: false,
                        beforeSend: function () {
                            $('.loader').removeClass('d-none');
                        },
                        success: (Result) => {
                            $("#EditJobApply").css('display', 'none !important');
                            if (Result) {
                                $("#EditJobApply").modal('hide');
                                swal.fire({
                                    title: "Updated Successfully",
                                    text: "",
                                    icon: "success",
                                    allowOutsideClick: false  // This prevents closing on outside click
                                }).then((resultValue) => {
                                    window.location.href = "/WebsiteJob/OAuthCallback?CandidateId=" + candidatesMenuId;
                                });
                            }
                            else {
                                swal.fire({
                                    title: "Something error",
                                    text: "",
                                    icon: "error",
                                    allowOutsideClick: false  // This prevents closing on outside click
                                }).then((resultValue) => {
                                    window.location.href = "/WebsiteJob/WebsiteCandidateMenu";
                                });
                            }
                            $('.loader').addClass('d-none');
                        },
                        error: (Result) => {
                            $('.loader').addClass('d-none');
                        }
                    });
                }
                else {
                    $('.loader').addClass('d-none');
                    $("#errVerify-ScheduledEndTime").show();
                    return false;
                }
            }
        });
    });

    // update Designation

    $('#getJobApplyData').on('click', '#btnStatus', function () {
      
        $("#success_CandidateStatus_Popup").modal('show');

        var id = $(this).data("id");
        var status = $(this).data("statusid");
        var optionValue = $("#CandidateStsId option").filter(function () {
            return $(this).text() === status;
        }).val();
        $("#CandidateStsId").val(optionValue).change();

        $('#success_CandidateStatus_Popup').on('click', '#btnUpdateStatus', function () {
            $("#errValid-CandidateStsId").text("");
            var isValid = true;
            var candidateStatus = $("#CandidateStsId").val();
            if ($("#CandidateStsId").val() == "") {
                $("#errValid-CandidateStsId").text("Status field is required");
                isValid = false;
            }
            var websiteCandidateMenuModel = {
                CandidateMenuId: id,
                CandidateStatusId: candidateStatus
            };
            if (isValid) {
                $('.loader').removeClass('d-none');
                $.ajax({
                    type: "POST",
                    url: "/WebsiteJob/WebsiteUpdateCandidateStatus",
                    data: websiteCandidateMenuModel,
                    success: (Result) => {
                        $("#success_CandidateStatus_Popup").css('display', 'none !important');
                        if (Result > 0) {
                            $("#success_CandidateStatus_Popup").modal('hide');
                            swal.fire({
                                title: "Status Updated Successfully",
                                text: "",
                                icon: "success",
                                allowOutsideClick: false
                            }).then((resultValue) => {
                                window.location.href = "/WebsiteJob/WebsiteCandidateMenu";
                            });

                        }
                        else {
                            swal.fire({
                                title: "Something error",
                                text: "",
                                icon: "error",
                                allowOutsideClick: false
                            }).then((resultValue) => {
                                window.location.href = "/WebsiteJob/WebsiteCandidateMenu";
                            });

                        }
                        $('.loader').addClass('d-none');
                    },
                    error: (Result) => {
                        $('.loader').addClass('d-none');
                    }
                });
            }
            else {
                return false;
                $('.loader').addClass('d-none');
            }
        });
        $("#errValid-CandidateStsId").text("");
    });

    $("#btnClose").click(function () {
        $("#success_CandidateStatus_Popup").modal('hide');
    });
    $(document).ready(function () {
        $('#success_CandidateStatus_Popup').modal({
            backdrop: 'static',
            keyboard: false
        })
        $('#EditJobApply').modal({
            backdrop: 'static',
            keyboard: false
        })


        $('#getJobApplyData').on('click', '.btnDownload', function () {       
            var subject = $(this).data("file");
            var urlName = window.location.origin;
            window.open(urlName + '/Management/' + subject + '');
        });

    });


    //UPDATE SCHEDULE

    $("#btnSchedule").click(function () {
        $("#errValid-schedule").text("");
        $("#EditJobApply").modal('hide');
        $("#candidateSchedule").val("");
        $("#errValid-ScheduledDate").text("");
        $("#errValid-StartTime").text("");
        $("#errValid-EndTime").text("");
        $("#EmployeeId").val("");
        $("#errValid-EmployeeId").text("");
    });

    

    // Time Validation

    function getTimeValid(scheduleddate, starttime, endtime) {
        console.log("scheduleddate :" + scheduleddate);
        var result = false;
        var fromDateTime = new Date(scheduleddate + ' ' + starttime);
        var toDateTime = new Date(scheduleddate + ' ' + endtime);
        console.log("fromDateTime :" + fromDateTime);
        console.log("toDateTime :" + toDateTime);
        if (fromDateTime < toDateTime) {
            result = true;
        }
        return result;
    }
</script>
